import{DrawingUtils as C,FilesetResolver as O,HandLandmarker as v}from"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.18";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))m(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const s of n.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&m(s)}).observe(document,{childList:!0,subtree:!0});function l(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function m(e){if(e.ep)return;e.ep=!0;const n=l(e);fetch(e.href,n)}})();const I=document.getElementById("webcamButton"),M=document.getElementById("startGameButton"),F=document.getElementById("ckeckButton"),o=document.getElementById("webcam"),i=document.getElementById("output_canvas"),w=i.getContext("2d"),H=document.querySelector("#myimage"),d=document.getElementById("simonText"),b=document.getElementById("score"),h=new C(w);let k,x=!1,r,E=null;const p=["fist","thumbsUp","point"];let g=null,c=0;async function G(){E=await tf.loadLayersModel("./model/model.json"),console.log("Model geladen")}const N=async()=>{const t=await O.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.0/wasm");k=await v.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/hand_landmarker/hand_landmarker/float16/1/hand_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",numHands:1}),console.log("HandLandmarker geladen")};async function S(){x=!0;try{const t=await navigator.mediaDevices.getUserMedia({video:!0,audio:!1});o.srcObject=t,o.addEventListener("loadeddata",()=>{i.width=o.videoWidth,i.height=o.videoHeight,document.querySelector(".videoView").style.height=o.videoHeight+"px",L()})}catch(t){console.error("Error accessing webcam:",t)}}async function L(){if(r=await k.detectForVideo(o,performance.now()),w.clearRect(0,0,i.width,i.height),r.landmarks.length>0){const t=r.landmarks[0];h.drawConnectors(t,v.HAND_CONNECTIONS,{color:"#00FF00",lineWidth:5}),h.drawLandmarks(t,{radius:4,color:"#FF0000",lineWidth:2});let a=t[4];H.style.transform=`translate(${o.videoWidth-a.x*o.videoWidth}px, ${a.y*o.videoHeight}px)`}x&&window.requestAnimationFrame(L)}function B(){const t=Math.floor(Math.random()*p.length);g=p[t],d.textContent=`Simon says: ${g}`}async function U(){if(!(r!=null&&r.landmarks)||r.landmarks.length===0){d.textContent="❗ Geen hand gedetecteerd.";return}const a=r.landmarks[0].flatMap(f=>[f.x,f.y,f.z]),l=tf.tensor2d([a]),e=await E.predict(l).array(),n=e[0].indexOf(Math.max(...e[0])),u=["fist","thumbsUp","point"][n];console.log("Voorspelling:",u),u===g?(c++,b.textContent=c,d.textContent="✅ Correct! Volgende komt eraan...",setTimeout(()=>B(),1e3)):d.textContent=`❌ Fout! Jij deed: ${u}, klik start game om opnieuw te beginnen.`}I.addEventListener("click",S);M.addEventListener("click",()=>{c=0,b.textContent=c,B()});F.addEventListener("click",U);var y;(y=navigator.mediaDevices)!=null&&y.getUserMedia&&G().then(N);
